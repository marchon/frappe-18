## Client scripts


* [Developer cheat-sheet](https://github.com/frappe/frappe/wiki/Developer-Cheatsheet)

[textbox capture focus](https://discuss.erpnext.com/t/is-there-any-tigger-to-capture-the-onclick-event-of-a-text-box/23134/3)

```
frappe.ui.form.on(cur_frm.doctype, {
    'onload_post_render': function(frm) {    
        frm.fields_dict.items.grid.wrapper.on('focus', 'input[data-fieldname="item_name"][data-doctype="Sales Invoice Item"]', function(e) {
            console.log(e.type);
        });
    }
});
```

[on change server side api call ](https://frappe.io/docs/user/en/tutorial/form-client-scripting)

```
frappe.ui.form.on("Library Transaction", "library_member",
    function(frm) {
        frappe.call({
            "method": "frappe.client.get",
            args: {
                doctype: "Library Member",
                name: frm.doc.library_member
            },
            callback: function (data) {
                frappe.model.set_value(frm.doctype,
                    frm.docname, "member_name",
                    data.message.first_name
                    + (data.message.last_name ?
                        (" " + data.message.last_name) : ""))
            }
        })
    });
```    

[link button ](https://discuss.erpnext.com/t/display-a-read-only-link-field-as-a-button/8315)
```
frappe.ui.form.on("my doctype", "my button", function(frm) { frappe.set_route("Form", ..., frm.doc.link  });
```

#### filters

```
filters: [
  ["DocType", "docfield", "op", "value"]
]
=
>
<
>=
<=
<>
like
```		

#### set value in model

```
frappe.model.set_value(doctype, name, fieldname, value)
```

```
row=$(cur_frm.fields_dict.child_table_name.grid.add_new_row())
then you can use frappe.model.set_value
e.g. you can refer this example in journal entry.js
var credit_row = frm.fields_dict.accounts.grid.add_new_row();
frappe.model.set_value(credit_row.doctype, credit_row.name, "account", values.credit_account);
```

```
frappe.ui.form.on("Grade Sheet", "score_on_form_rendered", function (doc, grid_row) {
    var grid_row = cur_frm.open_grid_row();
    grid_row.fields_dict.student.set_value("Testing");
})
```


#### [set filter in child table](https://discuss.erpnext.com/t/set-filter-in-child-table-with-value-from-same-table/10929/9)

```

frappe.ui.form.on("Sales Invoice", {
refresh : function(frm, cdt, cdn) {
	// item_code is a field in grid whose fieldname is items.. refer Sales Invoice
	frm.set_query("item_code", "items", function(doc) {
		if (frm.doc.custom_checkfield == 1) {
			return { "filters" : {"valuation_rate" : "10"}}
		} else {
			return { "filters" : {}}
		}
	});
	
	console.dir(cur_frm.fields_dict.items.grid.get_field("item_code"));
    }
);		

frappe.ui.form.on("Bank Reconciliation", "onload", function(frm) {
    cur_frm.set_query("bank_account", function() {
        return {
            "filters": {
                "account_type": "Bank",
                "group_or_ledger": "Ledger"
            }
        };
    });
});
def before_insert_customer(doc, method=None): 
    if doc.lead_name:
        for contact in frappe.get_all("Contact", {"lead": doc.lead_name}): 
            frappe.db.set_value("Contact", contact["name"], "lead", self.lead_name)
			
```


#### listview sample

```
		
			
frappe.listview_settings['Purchase Order'] = {
	add_fields: ["base_grand_total", "company", "currency", "supplier",
		"supplier_name", "per_received", "per_billed", "status"],
	get_indicator: function (doc) {
		if (doc.status === "Closed") {
			return [__("Closed"), "green", "status,=,Closed"];
		} else if (doc.status === "Delivered") {
			return [__("Delivered"), "green", "status,=,Closed"];
		} else if (flt(doc.per_received, 2) < 100 && doc.status !== "Closed") {
			if (flt(doc.per_billed, 2) < 100) {
				return [__("To Receive and Bill"), "orange",
					"per_received,<,100|per_billed,<,100|status,!=,Closed"];
			} else {
				return [__("To Receive"), "orange",
					"per_received,<,100|per_billed,=,100|status,!=,Closed"];
			}
		} else if (flt(doc.per_received, 2) == 100 && flt(doc.per_billed, 2) < 100 && doc.status !== "Closed") {
			return [__("To Bill"), "orange", "per_received,=,100|per_billed,<,100|status,!=,Closed"];
		} else if (flt(doc.per_received, 2) == 100 && flt(doc.per_billed, 2) == 100 && doc.status !== "Closed") {
			return [__("Completed"), "green", "per_received,=,100|per_billed,=,100|status,!=,Closed"];
		}
	},
	onload: function (listview) {
		var method = "erpnext.buying.doctype.purchase_order.purchase_order.close_or_unclose_purchase_orders";

		listview.page.add_menu_item(__("Close"), function () {
			listview.call_for_selected_items(method, { "status": "Closed" });
		});

		listview.page.add_menu_item(__("Re-open"), function () {
			listview.call_for_selected_items(method, { "status": "Submitted" });
		});
	}
};			
			